{% load i18n static %}
<link href="{% static 'css/style.css' %}" media="all" rel="stylesheet" type="text/css">
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lista de Plugins</title>
</head>
<body>
<form >{% csrf_token %}
    <table class="table-search">
        <tr>
            <td>{{ forms.keyword }}
            </td>
            <td>
                <button type="submit">Buscar</button>
            </td>
        </tr>
<tr></tr>
        <tr>
            <td>
                {{ forms.fields_search }}
                {{forms.comparation}}
            </td>
            <td>
                <input type="number" value="{{forms.range}}" name="range">
            </td>
        </tr>
    </table>
</form>
<table class="table" id="tblDash-{{ instance.id }}">

  <thead>
    <tr>
      <th>Nome</th>
      <th>Tipo (Classe)</th>
      <th>Quantidade Publicada</th>
      <th>Quantidade Rascunho</th>
    </tr>
  </thead>
  <tbody>
{% for object in object_list %}
    <tr>
      <td><a href="{{ object.url }}" target="_blank">{{ object.name }}</a></td>
      <td>{{ object.type }}</td>
      <td align="center">{{ object.amount_published }}</td>
      <td align="center">{{ object.amount_draft }}</td>
    </tr>
{% endfor %}
  {% if not object_list %}
    <tr><td colspan="4">* NENHUM PLUGIN ENCONTRADO</td></tr>
{% endif %}

  </tbody>
</table>

<div class="carregar-mais casa-color c-15">
            <strong></strong>
</div>

</body>
</html>


<script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">

</script>
<script type="text/javascript">
    $(document).ready(function () {


         var dashboards_ajax = function (url, qtd_items, qtd_items_listados) {
             console.log(qtd_items);
             console.log(qtd_items_listados);
            $.ajax({
                dataType: "json",
                url: url,
                data: {
                    'qtd_items': qtd_items,
                    'qtd_items_listados': qtd_items_listados
                },
                success: function (response) {
                    update_dashboards(response);
                }
            });
         }


        var url = "{% url  'ajax_dashs:plugins_list' %}";
        var qtd_items = 5;
        var qtd_items_listados = 0;

        dashboards_ajax(url, qtd_items, qtd_items_listados);


        var plugin = $('#tblDash-{{ instance.id }}');


        plugin.find('.carregar-mais').click(function () {
            var qtd_items = $('#tblDash tr').length + 5;
            var qtd_items_listados = $('#tblDash tr').length;
            var url = "{% url 'ajax_dashs:plugins_list'  %}";
            dashboards_ajax(url, qtd_items, qtd_items_listados);
        });


        plugin.find('.carregar-mais').hide();


        var update_dashboards = function (data) {

            if (data.pluginsList.length > 0) {

{#                $(clips).appendTo("#dashboards-{{ clip.id }}");#}

                if (data.pluginsList.length < 10) {
                    plugin.find('.carregar-mais').hide();
                } else {
                    plugin.find('.carregar-mais').show();
                    plugin.find('.carregar-mais strong').text('Carregar mais');
                }
            } else {
                plugin.find('.carregar-mais').show();
                plugin.find('.carregar-mais strong').text('Sem nada para carregar');
            }
        }
    });

</script>
